{"ast":null,"code":"import _regeneratorRuntime from \"/Users/jeong-go-eun/Desktop/meta-dapp-voting/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/jeong-go-eun/Desktop/meta-dapp-voting/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport Web3 from 'web3';\nimport { constants } from './constants';\n\nvar getWeb3Instance = function getWeb3Instance() {\n  return new Promise(function (resolve, reject) {\n    // Wait for loading completion to avoid race conditions with web3 injection timing.\n    window.addEventListener('load',\n    /*#__PURE__*/\n    _asyncToGenerator(\n    /*#__PURE__*/\n    _regeneratorRuntime.mark(function _callee() {\n      var web3, errorMsg, netIdName, netId, network, defaultAccount, accounts, _network;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              web3 = null; // Checking if Web3 has been injected by the browser (Mist/MetaMask)\n\n              if (!window.ethereum) {\n                _context.next = 16;\n                break;\n              }\n\n              web3 = new Web3(window.ethereum);\n              console.log('Injected web3 detected.');\n              _context.prev = 4;\n              _context.next = 7;\n              return window.ethereum.enable();\n\n            case 7:\n              _context.next = 14;\n              break;\n\n            case 9:\n              _context.prev = 9;\n              _context.t0 = _context[\"catch\"](4);\n              console.error('User denied account access');\n              reject({\n                message: 'User denied account access'\n              });\n              return _context.abrupt(\"return\");\n\n            case 14:\n              _context.next = 17;\n              break;\n\n            case 16:\n              if (typeof window.web3 !== 'undefined') {\n                web3 = new Web3(window.web3.currentProvider);\n                console.log('Injected web3 detected.');\n              }\n\n            case 17:\n              errorMsg = null;\n              defaultAccount = null;\n\n              if (!web3) {\n                _context.next = 34;\n                break;\n              }\n\n              _context.next = 22;\n              return web3.eth.net.getId();\n\n            case 22:\n              netId = _context.sent;\n              _context.next = 25;\n              return web3.eth.net.getNetworkType();\n\n            case 25:\n              network = _context.sent;\n              console.log('netId: ', netId, ', network: ', network);\n\n              if (!(netId in constants.NETWORKS) || network !== 'private') {\n                netIdName = 'ERROR';\n                errorMsg = 'This is an unknown network.';\n                console.log('This is an unknown network.');\n              } else {\n                netIdName = constants.NETWORKS[netId].NAME;\n                console.log(\"This is \".concat(netIdName));\n              }\n\n              _context.next = 30;\n              return web3.eth.getAccounts();\n\n            case 30:\n              accounts = _context.sent;\n              defaultAccount = accounts[0] || null;\n              _context.next = 40;\n              break;\n\n            case 34:\n              // Fallback to local if no web3 injection.\n              console.log('No web3 instance injected, using Local web3.');\n              console.error('Metamask not found');\n              netId = constants.NETID_TESTNET;\n              _network = constants.NETWORKS[netId];\n              web3 = new Web3(new Web3.providers.HttpProvider(_network.RPC));\n              netIdName = _network.NAME;\n\n            case 40:\n              if (!(errorMsg !== null)) {\n                _context.next = 43;\n                break;\n              }\n\n              reject({\n                message: errorMsg\n              });\n              return _context.abrupt(\"return\");\n\n            case 43:\n              resolve({\n                web3Instance: web3,\n                netIdName: netIdName,\n                netId: netId,\n                defaultAccount: defaultAccount\n              });\n\n            case 44:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, this, [[4, 9]]);\n    })));\n  });\n};\n\nexport default getWeb3Instance;","map":{"version":3,"sources":["/Users/jeong-go-eun/Desktop/meta-dapp-voting/src/ethereum/web3.js"],"names":["Web3","constants","getWeb3Instance","Promise","resolve","reject","window","addEventListener","web3","ethereum","console","log","enable","error","message","currentProvider","errorMsg","defaultAccount","eth","net","getId","netId","getNetworkType","network","NETWORKS","netIdName","NAME","getAccounts","accounts","NETID_TESTNET","providers","HttpProvider","RPC","web3Instance"],"mappings":"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","sourcesContent":["import Web3 from 'web3'\nimport {constants} from './constants'\n\nlet getWeb3Instance = () => {\n    return new Promise((resolve, reject) => {\n      // Wait for loading completion to avoid race conditions with web3 injection timing.\n      window.addEventListener('load', async () => {\n        let web3 = null;\n        // Checking if Web3 has been injected by the browser (Mist/MetaMask)\n        if (window.ethereum) {\n          web3 = new Web3(window.ethereum)\n          console.log('Injected web3 detected.')\n          try {\n            await window.ethereum.enable()\n          } catch (e) {\n            console.error('User denied account access')\n            reject({ message: 'User denied account access' })\n            return\n          }\n        } else if (typeof window.web3 !== 'undefined') {\n          web3 = new Web3(window.web3.currentProvider)\n          console.log('Injected web3 detected.')\n        }\n  \n        let errorMsg = null\n        let netIdName\n        let netId\n        let network\n        let defaultAccount = null\n  \n        if (web3) {\n          netId = await web3.eth.net.getId()\n          network = await web3.eth.net.getNetworkType()\n          console.log('netId: ', netId, ', network: ', network)\n          if (!(netId in constants.NETWORKS) || network !== 'private') {\n            netIdName = 'ERROR'\n            errorMsg = 'This is an unknown network.'\n            console.log('This is an unknown network.')\n          } else {\n            netIdName = constants.NETWORKS[netId].NAME\n            console.log(`This is ${netIdName}`)\n          }\n          const accounts = await web3.eth.getAccounts()\n          defaultAccount = accounts[0] || null\n          \n        } else {\n          // Fallback to local if no web3 injection.\n          console.log('No web3 instance injected, using Local web3.')\n          console.error('Metamask not found')\n  \n          netId = constants.NETID_TESTNET;\n  \n          const network = constants.NETWORKS[netId]\n  \n          web3 = new Web3(new Web3.providers.HttpProvider(network.RPC))\n          netIdName = network.NAME\n        }\n    \n        if (errorMsg !== null) {\n          reject({ message: errorMsg })\n          return\n        }\n  \n        resolve({\n          web3Instance: web3,\n          netIdName,\n          netId,\n          defaultAccount\n        })\n      })\n    })\n  }\n  \n  export default getWeb3Instance"]},"metadata":{},"sourceType":"module"}